<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Gastos Marcio y Angie</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:wght@400&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root { --bg: #F5F0E8; --accent: #C94F2C; --green: #2C7A4B; --gold: #E8A020; --ink: #1A1208; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--ink); padding: 1rem; max-width: 600px; margin: 0 auto; }
    h1 { font-family: 'DM Serif Display', serif; font-size: 2rem; margin-bottom: 1rem; }
    .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .tab-btn { flex: 1; padding: 0.75rem; border: none; background: #ddd; cursor: pointer; font-weight: 500; border-radius: 0.25rem; }
    .tab-btn.active { background: var(--accent); color: white; }
    .tab-content { display: none; padding: 1rem 0; }
    .tab-content.active { display: block; }
    .btn-principal { width: 100%; padding: 1rem; background: var(--accent); color: white; border: none; border-radius: 0.5rem; font-weight: 700; cursor: pointer; font-size: 1rem; margin-top: 1rem; }
    .entry-card { background: white; padding: 1rem; margin-bottom: 0.75rem; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .entry-header { display: flex; gap: 0.75rem; align-items: center; margin-bottom: 0.5rem; }
    .entry-amount { font-weight: 700; color: var(--accent); margin-left: auto; }
    .empty { text-align: center; padding: 2rem; color: #999; }
    .total-card { background: white; padding: 1rem; border-radius: 0.5rem; text-align: center; margin-bottom: 0.75rem; }
    .total-amount { font-family: 'DM Serif Display', serif; font-size: 1.5rem; color: var(--accent); }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: flex-end; align-items: flex-end; }
    .modal.open { display: flex; }
    .modal-content { background: white; width: 100%; padding: 1.5rem; border-radius: 1rem 1rem 0 0; max-height: 80vh; overflow-y: auto; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
    .form-group input, .form-group select { width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 0.25rem; font-size: 1rem; }
    .btn-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 0.5rem; margin-bottom: 1rem; }
    .btn-grupo-item { padding: 0.75rem; border: 2px solid #ddd; background: white; cursor: pointer; border-radius: 0.25rem; font-weight: 500; }
    .btn-grupo-item.active { background: var(--accent); color: white; border-color: var(--accent); }
    .form-actions { display: flex; gap: 0.5rem; margin-top: 1rem; }
    .btn-guardar { flex: 1; background: var(--green); color: white; padding: 0.75rem; border: none; border-radius: 0.25rem; cursor: pointer; font-weight: 500; }
    .btn-cancelar { flex: 1; background: #ddd; padding: 0.75rem; border: none; border-radius: 0.25rem; cursor: pointer; }
    .btn-delete { padding: 0.5rem 1rem; background: #f0f0f0; border: none; border-radius: 0.25rem; cursor: pointer; }
    .resumen-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .btn-mes { background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer; }
    @media (max-width: 480px) { body { padding: 0.75rem; } }
  </style>
</head>
<body>
  <h1>Gastos ðŸ’°</h1>
  <div class="tabs">
    <button class="tab-btn active" data-tab="resumen">Resumen</button>
    <button class="tab-btn" data-tab="movimientos">Movimientos</button>
    <button class="tab-btn" data-tab="deudas">Deudas</button>
  </div>
  <div id="resumen" class="tab-content active"></div>
  <div id="movimientos" class="tab-content"></div>
  <div id="deudas" class="tab-content"></div>
  <button id="btn-agregar" class="btn-principal">+ Agregar entrada</button>

  <div id="modal" class="modal">
    <div class="modal-content">
      <h2>Agregar entrada</h2>
      <div class="form-group">
        <label>Tipo</label>
        <div class="btn-group">
          <button class="btn-grupo-item active" data-type="gasto">Gasto</button>
          <button class="btn-grupo-item" data-type="ahorro">Ahorro</button>
          <button class="btn-grupo-item" data-type="deuda">Deuda</button>
        </div>
      </div>
      <div class="form-group">
        <label>Monto (Gs.)</label>
        <input type="number" id="monto" placeholder="100000" min="1">
      </div>
      <div class="form-group">
        <label>Quien paga</label>
        <select id="quien">
          <option value="Marcio">Marcio</option>
          <option value="Angie">Angie</option>
        </select>
      </div>
      <div class="form-group">
        <label>Descripcion</label>
        <input type="text" id="desc" placeholder="Supermercado">
      </div>
      <div class="form-actions">
        <button id="btn-guardar" class="btn-guardar">Guardar</button>
        <button id="btn-cerrar" class="btn-cancelar">Cancelar</button>
      </div>
    </div>
  </div>

  <script>
let entries = [];
let currentType = 'gasto';
let currentTab = 'resumen';

function fmt(n) { return 'Gs. ' + n.toLocaleString('es-PY'); }

function guardar() {
  localStorage.setItem('casa_entries', JSON.stringify(entries));
}

function cargar() {
  const d = localStorage.getItem('casa_entries');
  if (d) entries = JSON.parse(d);
}

function render() {
  const mes = new Date().getMonth();
  const ano = new Date().getFullYear();
  const mesEntries = entries.filter(e => e.month === mes && e.year === ano);

  if (currentTab === 'resumen') {
    const gastos = mesEntries.filter(e => e.type === 'gasto');
    const total = gastos.reduce((s, e) => s + e.amount, 0);
    const marcio = gastos.reduce((s, e) => s + (e.who === 'Marcio' ? e.amount : 0), 0);
    const angie = total - marcio;
    let html = '<div class="total-card"><div>Total</div><div class="total-amount">' + fmt(total) + '</div></div>';
    html += '<div class="total-card"><div>Marcio</div><div class="total-amount">' + fmt(marcio) + '</div></div>';
    html += '<div class="total-card"><div>Angie</div><div class="total-amount">' + fmt(angie) + '</div></div>';
    if (gastos.length > 0) {
      gastos.slice(0, 5).forEach(e => {
        const f = new Date(e.date);
        html += '<div class="entry-card"><div class="entry-header"><span>' + e.who + '</span><span class="entry-amount">' + fmt(e.amount) + '</span></div><div>' + e.description + '</div></div>';
      });
    } else html += '<p class="empty">Sin movimientos</p>';
    document.getElementById('resumen').innerHTML = html;
  } else if (currentTab === 'movimientos') {
    let html = '';
    if (mesEntries.length === 0) html = '<p class="empty">Sin movimientos</p>';
    else {
      mesEntries.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(e => {
        const f = new Date(e.date);
        html += '<div class="entry-card"><div class="entry-header"><span>' + e.who + '</span><span class="entry-amount">' + fmt(e.amount) + '</span></div><div>' + e.description + '</div><button class="btn-delete" onclick="eliminar(this)" data-id="' + e.id + '">X</button></div>';
      });
    }
    document.getElementById('movimientos').innerHTML = html;
  } else if (currentTab === 'deudas') {
    const deudas = entries.filter(e => e.type === 'deuda');
    const pend = deudas.filter(e => !e.paid);
    const pag = deudas.filter(e => e.paid);
    let html = '';
    if (pend.length > 0) {
      html += '<h3>Pendientes</h3>';
      pend.forEach(e => {
        html += '<div class="entry-card"><div class="entry-header"><span>' + e.who + '</span><span class="entry-amount">' + fmt(e.amount) + '</span></div><button onclick="pagar(this)" data-id="' + e.id + '">Pagar</button></div>';
      });
    }
    if (pag.length > 0) {
      html += '<h3>Pagadas</h3>';
      pag.forEach(e => {
        html += '<div class="entry-card" style="opacity:0.6;"><div class="entry-header"><span>' + e.who + '</span><span class="entry-amount">' + fmt(e.amount) + '</span></div></div>';
      });
    }
    if (pend.length === 0 && pag.length === 0) html = '<p class="empty">Sin deudas</p>';
    document.getElementById('deudas').innerHTML = html;
  }
}

function eliminar(btn) {
  const id = btn.dataset.id;
  entries = entries.filter(e => e.id !== id);
  guardar();
  render();
}

function pagar(btn) {
  const id = btn.dataset.id;
  const e = entries.find(x => x.id === id);
  if (e) { e.paid = true; guardar(); render(); }
}

document.getElementById('btn-agregar').addEventListener('click', () => {
  document.getElementById('modal').classList.add('open');
});

document.getElementById('btn-cerrar').addEventListener('click', () => {
  document.getElementById('modal').classList.remove('open');
  document.getElementById('monto').value = '';
  document.getElementById('desc').value = '';
});

document.getElementById('btn-guardar').addEventListener('click', () => {
  const m = parseInt(document.getElementById('monto').value);
  if (!m) { alert('Ingresa monto'); return; }
  entries.push({
    id: Date.now().toString(),
    type: currentType,
    amount: m,
    who: document.getElementById('quien').value,
    description: document.getElementById('desc').value,
    date: new Date().toISOString(),
    month: new Date().getMonth(),
    year: new Date().getFullYear(),
    paid: false
  });
  guardar();
  document.getElementById('modal').classList.remove('open');
  render();
});

document.querySelectorAll('.tab-btn').forEach(b => {
  b.addEventListener('click', e => {
    document.querySelectorAll('.tab-btn').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
    e.target.classList.add('active');
    currentTab = e.target.dataset.tab;
    document.getElementById(currentTab).classList.add('active');
    render();
  });
});

document.querySelectorAll('[data-type]').forEach(b => {
  b.addEventListener('click', e => {
    document.querySelectorAll('[data-type]').forEach(x => x.classList.remove('active'));
    e.target.classList.add('active');
    currentType = e.target.dataset.type;
  });
});

cargar();
window.addEventListener('load', render);
  </script>
</body>
</html>
